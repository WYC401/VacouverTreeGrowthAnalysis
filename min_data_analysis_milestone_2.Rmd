---
title: "mini_data_analysis_milestone_2"
author: "Yicheng Wang"
date: "10/11/2021"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Mini Data Analysis Milestone 2
Before all, we need to load the two packages needed, where the dataset of interest vancouver_trees is in. And we will print the first 6 rows of the data for the manipulation and plotting latter.
```{r}
library(datateachr) # <- might contain the data you picked!
library(tidyverse)
library(psych)
print(head(vancouver_trees))
```
## 1. Process and Summarize data 
### 1.1 Review of 4 Research Problems

1. Are the parameters of the tree like diameter equally distributed among different species?
2. Do some species of trees concentrate on some places? Or are the trees equally distributed among the map?
3. What is the relationship between the age of trees and their diameter or other parameter?
4. What is effect of root barrier on the growth of trees(their diameter)?  

### 1.2 Graph and Summarize 

For the 1st problem, the first thing comes to my mind is that we can take a look at how many data points falls into each species. It is important to know about this because some minority species with one or two record may not have much value to study on it. We want to focus on the serveral majority species.
```{r}

subset_1 <- vancouver_trees%>%
  group_by(species_name)%>%
  summarise(number_of_records=n())%>%
  arrange(desc(number_of_records))

print(subset_1[1:10,])
```

Next, we center our focus on the top 10 species. To better see the difference between diameter distribution among species, let's draw the density graphs of the 10 species. 
```{r}
  subset_1=subset_1[1:10,]
  print(subset_1)
  plot_1=filter( vancouver_trees, species_name %in% subset_1$species_name) %>% 
  ggplot(aes(diameter,species_name)) +
  ggridges::geom_density_ridges()
  print(plot_1)

```

For the second research problem, we first find the medians of both the latitude and the latitude of trees. And we divide the area trees stand into 4 regions according to the medians of the latitudes and the latitudes: West North, East North, West South and East South. Then, we caculate the summary statistics of `height_range_id` among different regions/positions.
```{r}

  med_position<-apply(na.omit(vancouver_trees[,c("longitude","latitude")]),2,median)
  table_with_position <-vancouver_trees %>% 
     mutate(position = case_when( (longitude< med_position[1]) & (latitude<med_position[2])  ~ "West South",  
                                  (longitude< med_position[1]) & (latitude>=med_position[2])  ~ "West North",
                                (longitude>= med_position[1]) & (latitude<med_position[2])  ~ "East South",
                                 TRUE ~ "East North"))
  summary=table_with_position%>%
            group_by(position)%>%
            do(describe(.$height_range_id))
  print(summary)

  
```

Then, we plot the mean of the trees' diameter among each region. It seems that the trees in the West North region tend to be higher than those in the other 3 regions.

```{r}
  ggplot(summary,aes(position,mean))+
    geom_col()+
    geom_text(aes(label=mean),position=position_dodge(0.9),vjust=0)

```

For the third research problem, the age of trees should be calculated first to form a new column.Since the variable `heights_range_id` take the level 1-10 to indicate the height of the trees, we can use it as categorical variables to
see if summarized statistics of ages like mean and median are different among trees of different height level. So, we create a table to compute the median,range, mean and standard deviation of ages(by months) among different height levels.
```{r}
  vancouver_trees <- table_with_position
  #create a new column caculating the ages of trees in months
  vancouver_trees$age_months=as.numeric(difftime(Sys.Date(),vancouver_trees$date_planted,units="days")/12)
  vancouver_trees%>%
    group_by(height_range_id)%>%
    summarise(age_mean_months=mean(age_months,na.rm=TRUE),age_range_months=max(age_months,na.rm=TRUE)-min(age_months,na.rm=TRUE),age_median_months=median(age_months,na.rm=TRUE), age_std_months=sd(age_months,na.rm=TRUE))
  
    
  
```